{"ast":null,"code":"import { Editor, Range, Path, Transforms } from 'slate';\nexport const onKeyDown = () => (e, editor) => {\n  let {\n    selection\n  } = editor;\n\n  if (e.key === 'Tab' && selection) {\n    const block = Editor.above(editor, {\n      match: n => Editor.isBlock(editor, n)\n    });\n\n    if (!block) {\n      return;\n    }\n\n    e.preventDefault();\n\n    if (block[0].type == 'list-item') {\n      if (Range.isCollapsed(selection)) {\n        const path = block[1];\n        const start = Editor.start(editor, path);\n        const range = {\n          anchor: selection.anchor,\n          focus: start\n        };\n        let beforeText = Editor.string(editor, range);\n\n        if (beforeText.length) {\n          Editor.insertText(editor, '\\t');\n          return;\n        }\n      } // // move down with tab\n      // const tab = !e.shiftKey;\n      // if (tab) {\n\n\n      moveListItemDown(editor, block[1]); // }\n    } else {\n      let p = selection.anchor;\n\n      if (Range.isCollapsed(selection)) {\n        p = p.path;\n      }\n\n      Transforms.select(editor, p);\n      Editor.insertText(editor, '\\t');\n      Transforms.select(editor, selection);\n    } // Editor.insertText(editor,'\\t')\n\n  }\n};\n\nfunction moveListItemDown(editor, path) {\n  let entry = Editor.parent(editor, path);\n  let node = entry[0];\n\n  if (node.type.endsWith('-list')) {\n    let ref = Editor.pathRef(editor, path);\n    let pre = Editor.previous(editor, {\n      at: path\n    });\n    let next = Editor.next(editor, {\n      at: path\n    });\n\n    if (pre) {\n      Transforms.splitNodes(editor, {\n        at: path\n      });\n    }\n\n    if (next) {\n      Transforms.splitNodes(editor, {\n        at: Path.next(ref.current)\n      });\n    }\n\n    path = ref.unref();\n    Transforms.setNodes(editor, {\n      indent: node.indent + 1\n    }, {\n      at: Path.parent(path)\n    });\n  }\n}","map":{"version":3,"sources":["/Users/yonggu/WebstormProjects/gyedit/src/onKeyDown.ts"],"names":["Editor","Range","Path","Transforms","onKeyDown","e","editor","selection","key","block","above","match","n","isBlock","preventDefault","type","isCollapsed","path","start","range","anchor","focus","beforeText","string","length","insertText","moveListItemDown","p","select","entry","parent","node","endsWith","ref","pathRef","pre","previous","at","next","splitNodes","current","unref","setNodes","indent"],"mappings":"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","sourcesContent":["import {Editor, Range, Path, Location, Transforms} from 'slate'\nimport { BlockElement} from './types'\n\n\nexport const onKeyDown = () => (\n    e: KeyboardEvent,\n    editor: Editor\n) => {\n    let {selection} = editor\n    if (e.key === 'Tab' && selection) {\n        const block = Editor.above(editor, {\n            match: n => Editor.isBlock(editor, n),\n        })\n        if (!block) {\n            return\n        }\n        e.preventDefault()\n        if (block[0].type == 'list-item') {\n            if (Range.isCollapsed(selection)) {\n                const path = block[1]\n                const start = Editor.start(editor, path)\n                const range = {anchor: selection.anchor, focus: start}\n                let beforeText = Editor.string(editor, range)\n                if (beforeText.length) {\n                    Editor.insertText(editor, '\\t')\n                    return\n                }\n            }\n            // // move down with tab\n            // const tab = !e.shiftKey;\n            // if (tab) {\n            moveListItemDown(editor, block[1]);\n            // }\n        } else {\n            let p: Location = selection.anchor\n            if (Range.isCollapsed(selection)) {\n                p = p.path\n            }\n            Transforms.select(editor, p)\n            Editor.insertText(editor, '\\t')\n            Transforms.select(editor, selection)\n        }\n        // Editor.insertText(editor,'\\t')\n    }\n};\n\nfunction moveListItemDown(editor: Editor, path: Path) {\n    let entry = Editor.parent(editor, path)\n    let node = entry[0] as BlockElement\n    if (node.type.endsWith('-list')) {\n        let ref = Editor.pathRef(editor,path)\n        let pre = Editor.previous(editor, {at: path})\n        let next = Editor.next(editor,{at:path})\n        if (pre) {\n            Transforms.splitNodes(editor, {at: path})\n        }\n        if (next) {\n            Transforms.splitNodes(editor, {at: Path.next(ref.current!)})\n        }\n        path = ref.unref()!\n        Transforms.setNodes(editor, {indent: node.indent! + 1}, {at: Path.parent(path)})\n\n    }\n}"]},"metadata":{},"sourceType":"module"}