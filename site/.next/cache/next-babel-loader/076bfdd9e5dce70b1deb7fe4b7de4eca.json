{"ast":null,"code":"import { Editor, Range, Transforms } from 'slate';\nexport const onKeyDown = () => (e, editor) => {\n  console.log(\"key down:\", e.key);\n  let {\n    selection\n  } = editor;\n\n  if (e.key === 'Tab' && selection) {\n    const {\n      anchor\n    } = selection;\n    const block = Editor.above(editor, {\n      match: n => Editor.isBlock(editor, n)\n    });\n\n    if (block && block[0].type == 'list-item') {\n      console.log(\"tab in list-item\");\n\n      if (Range.isCollapsed(selection)) {\n        const path = block[1];\n        const start = Editor.start(editor, path);\n        const range = {\n          anchor,\n          focus: start\n        };\n        let beforeText = Editor.string(editor, range);\n\n        if (beforeText.length) {\n          return;\n        }\n      }\n\n      e.preventDefault(); // move down with tab\n\n      const tab = !e.shiftKey;\n\n      if (tab) {\n        moveListItemDown(editor, block[1]);\n      }\n    }\n  }\n};\n\nfunction moveListItemDown(editor, path) {\n  const entry = Editor.parent(editor, path);\n  let node = entry[0];\n\n  if (node.type.endsWith('list')) {\n    console.log(\"indent:\", node.indent);\n    node.indent++;\n    Transforms.splitNodes(editor, {\n      at: path\n    });\n  }\n}","map":{"version":3,"sources":["/Users/yonggu/WebstormProjects/gyedit/src/onKeyDown.ts"],"names":["Editor","Range","Transforms","onKeyDown","e","editor","console","log","key","selection","anchor","block","above","match","n","isBlock","type","isCollapsed","path","start","range","focus","beforeText","string","length","preventDefault","tab","shiftKey","moveListItemDown","entry","parent","node","endsWith","indent","splitNodes","at"],"mappings":"AAAA,SAASA,MAAT,EAAiBC,KAAjB,EAAyCC,UAAzC,QAA2D,OAA3D;AAGA,OAAO,MAAMC,SAAS,GAAG,MAAM,CAC3BC,CAD2B,EAE3BC,MAF2B,KAG1B;AACDC,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBH,CAAC,CAACI,GAA3B;AACA,MAAI;AAACC,IAAAA;AAAD,MAAcJ,MAAlB;;AACA,MAAID,CAAC,CAACI,GAAF,KAAU,KAAV,IAAmBC,SAAvB,EAAkC;AAC9B,UAAM;AAAEC,MAAAA;AAAF,QAAaD,SAAnB;AACA,UAAME,KAAK,GAAGX,MAAM,CAACY,KAAP,CAAaP,MAAb,EAAqB;AAC/BQ,MAAAA,KAAK,EAAEC,CAAC,IAAId,MAAM,CAACe,OAAP,CAAeV,MAAf,EAAuBS,CAAvB;AADmB,KAArB,CAAd;;AAGA,QAAIH,KAAK,IAAIA,KAAK,CAAC,CAAD,CAAL,CAASK,IAAT,IAAiB,WAA9B,EAA2C;AACvCV,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;;AACA,UAAIN,KAAK,CAACgB,WAAN,CAAkBR,SAAlB,CAAJ,EAAkC;AAC9B,cAAMS,IAAI,GAAGP,KAAK,CAAC,CAAD,CAAlB;AACA,cAAMQ,KAAK,GAAGnB,MAAM,CAACmB,KAAP,CAAad,MAAb,EAAqBa,IAArB,CAAd;AACA,cAAME,KAAK,GAAG;AAACV,UAAAA,MAAD;AAASW,UAAAA,KAAK,EAAEF;AAAhB,SAAd;AACA,YAAIG,UAAU,GAAGtB,MAAM,CAACuB,MAAP,CAAclB,MAAd,EAAsBe,KAAtB,CAAjB;;AACA,YAAIE,UAAU,CAACE,MAAf,EAAsB;AAClB;AACH;AACJ;;AACDpB,MAAAA,CAAC,CAACqB,cAAF,GAXuC,CAYvC;;AACA,YAAMC,GAAG,GAAG,CAACtB,CAAC,CAACuB,QAAf;;AACA,UAAID,GAAJ,EAAS;AACLE,QAAAA,gBAAgB,CAACvB,MAAD,EAASM,KAAK,CAAC,CAAD,CAAd,CAAhB;AACH;AACJ;AACJ;AACJ,CA9BM;;AAgCP,SAASiB,gBAAT,CAA0BvB,MAA1B,EAAyCa,IAAzC,EAAoD;AAChD,QAAMW,KAAK,GAAG7B,MAAM,CAAC8B,MAAP,CAAczB,MAAd,EAAsBa,IAAtB,CAAd;AACA,MAAIa,IAAc,GAAGF,KAAK,CAAC,CAAD,CAA1B;;AACA,MAAIE,IAAI,CAACf,IAAL,CAAUgB,QAAV,CAAoB,MAApB,CAAJ,EAAiC;AAC7B1B,IAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAsBwB,IAAI,CAACE,MAA3B;AACAF,IAAAA,IAAI,CAACE,MAAL;AACA/B,IAAAA,UAAU,CAACgC,UAAX,CAAsB7B,MAAtB,EAA8B;AAAC8B,MAAAA,EAAE,EAAEjB;AAAL,KAA9B;AACH;AACJ","sourcesContent":["import { Editor, Range, Path, NodeEntry, Transforms } from 'slate'\nimport {ListNode, ListItemNode} from './types'\n\nexport const onKeyDown = () => (\n    e: KeyboardEvent,\n    editor: Editor\n) => {\n    console.log(\"key down:\", e.key)\n    let {selection} = editor\n    if (e.key === 'Tab' && selection) {\n        const { anchor } = selection\n        const block = Editor.above(editor, {\n            match: n => Editor.isBlock(editor, n),\n        })\n        if (block && block[0].type == 'list-item') {\n            console.log(\"tab in list-item\")\n            if (Range.isCollapsed(selection)) {\n                const path = block[1]\n                const start = Editor.start(editor, path)\n                const range = {anchor, focus: start}\n                let beforeText = Editor.string(editor, range)\n                if (beforeText.length){\n                    return\n                }\n            }\n            e.preventDefault()\n            // move down with tab\n            const tab = !e.shiftKey;\n            if (tab) {\n                moveListItemDown(editor, block[1]);\n            }\n        }\n    }\n};\n\nfunction moveListItemDown(editor:Editor, path: Path){\n    const entry = Editor.parent(editor, path)\n    let node: ListNode = entry[0] as ListNode\n    if (node.type.endsWith( 'list')) {\n        console.log(\"indent:\",node.indent)\n        node.indent ++\n        Transforms.splitNodes(editor, {at: path})\n    }\n}"]},"metadata":{},"sourceType":"module"}